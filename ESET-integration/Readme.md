# ESET Integration with Wazuh

This guide explains how to integrate ESET logs into Wazuh using a custom Python script and custom rules. This integration are done inside Wazuh Server VM, or you can create separate VM for logcollector with Wazuh Agent installed.

## Files

- `eset_logcollector.py` — Python script to collect ESET logs.
- `eset_daemon.service` — Systemd service to run the collector as a daemon.
- `420010-eset_rules.xml` — Custom Wazuh rules for ESET log parsing.

---

## Installation Steps

### 1. Create Directory and Deploy the Script

```bash
sudo mkdir -p /opt/eset
sudo cp eset_logcollector.py /opt/eset/
sudo chmod +x /opt/eset/eset_logcollector.py
```

### 2. Create and Enable the Systemd Service

```bash
sudo cp eset_daemon.service /etc/systemd/system/eset_daemon.service
sudo systemctl daemon-reload
sudo systemctl enable eset_daemon.service
sudo systemctl start eset_daemon.service
```

This will run `eset_logcollector.py` as a background service.

---

### 3. Configure `ossec.conf` to Collect Logs

Edit `/var/ossec/etc/ossec.conf` and add the following `<localfile>` block **inside** the `<localfile>` section:

```xml
<localfile>
  <log_format>json</log_format>
  <location>/var/log/eset-integration.log</location>
</localfile>
```

This tells Wazuh to monitor the output log generated by `eset_logcollector.py`.

---

### 4. Add Custom ESET Rules

Copy the `420010-eset_rules.xml` to Wazuh's rules directory:

```bash
sudo cp 420010-eset_rules.xml /var/ossec/etc/rules/
```

Make sure the file is readable by the Wazuh manager.

---

### 5. Restart Wazuh Manager

```bash
sudo systemctl restart wazuh-manager
```

This reloads the configuration and applies the new integration.

---

## Summary

| Component              | Location                                |
|-------------------------|----------------------------------------|
| Python Log Collector    | `/opt/eset/eset_logcollector.py`        |
| Systemd Service         | `/etc/systemd/system/eset-daemon.service` |
| Wazuh Custom Rules      | `/var/ossec/etc/rules/420010-eset_rules.xml` |
| Output Log Monitored    | `/var/log/eset-integration.log`         |

---

## Flow Diagram

```text
+---------------------+
| ESET Antivirus Logs |
+---------------------+
            ↓
+---------------------------+
| eset_logcollector.py      |
| (Collects and writes logs |
|  to a flat file)          |
+---------------------------+
            ↓
+-------------------------------+
| /var/log/eset-integration.log |
+-------------------------------+
            ↓
+---------------------+
|  Wazuh Manager      |
|  (Reads localfile)  |
+---------------------+
            ↓
+----------------------+
| Custom Rules Parsing |
| (420010-eset_rules.xml) |
+----------------------+
            ↓
+---------------------+
| Wazuh Alerts Raised |
+---------------------+
```

---

## Notes

- Ensure Python and necessary libraries are installed.
- Adjust permissions if needed for `/var/log/eset-integration.log`.
- Check Wazuh logs if you encounter issues after restarting the manager:
  ```bash
  sudo tail -f /var/ossec/logs/ossec.log
  ```
